const containerTemplate=document.createElement("template"),PANEL_HEIGHT=300,YELLOW="#FFDF22",DARK_GRAY="#2D343D",GRAY="#99A6B5",WHITE="#fff",BLACK="#000",DEFAULT_DARK_COLOR={containerBackgroundColor:"rgba(45, 52, 61, .9)",panelBackground:DARK_GRAY,panelHeaderBorderColor:GRAY,titleColor:GRAY,confirmButtonColor:YELLOW,cancelButtonColor:GRAY,textColor:WHITE,focusBorderColor:YELLOW,maskBackgroundColor:"rgb(45, 52, 61, .9)"},DEFAULT_LIGHT_COLOR={containerBackgroundColor:"rgba(210, 210, 210, .9)",panelBackground:GRAY,panelHeaderBorderColor:DARK_GRAY,titleColor:DARK_GRAY,confirmButtonColor:YELLOW,cancelButtonColor:DARK_GRAY,textColor:BLACK,focusBorderColor:YELLOW,maskBackgroundColor:"rgb(200, 200, 200, .9)"};containerTemplate.innerHTML=`
  <style>
    :host {
        display: block;
        height: auto;
        width: auto;
    }
    .scroll-picker-trigger {
        display: block;
        height: auto;
        width: auto;
    }
 
  </style>
 
  <div class="scroll-picker-trigger">
    <slot></slot>
  </div>
`;const styleTemplate=document.createElement("template");styleTemplate.innerHTML=`
<style>
    .scroll-picker-container {
        z-index: 9999;
        display: block;
        position: fixed;
        height: 100vh;
        width: 100vw;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        visibility: hidden;
    }

    .scroll-picker-show {
        visibility: visible !important;
    }

    .scroll-picker-panel {
        height: ${PANEL_HEIGHT}px;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        display: flex;
        flex-direction: column;
    }

    .scroll-picker-panel-header {
        z-index: 4;
        display: flex;
        justify-content: space-between;
        height: 40px;
        padding: 0 10px;
    }

    .scroll-picker-title {
      line-height: 40px;
      font-size: 18px;
    }

    .scroll-picker-btn{
        outline: none;
        font-size: 16px;
        border: none;
        background: transparent;
    }

    .scroll-picker-panel-content {
        flex: 1;
        display: flex;
        color: rgb(255, 255, 255); //
        background-color: transparent;
        overflow: hidden;
        z-index: 2;
    }

    .scroll-picker-colum {
      flex: 1;
      text-align: center;
      transition: transform .18s ease-out;
    }

    .scroll-picker-row {
      font-size: 15px;
      height: 40px;
      line-height: 40px;
      cursor: pointer;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .scroll-picker-center {
      height: 40px;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: auto;
    }

    .scroll-picker-mask {
      z-index: 3;
      position: absolute;
      top: 0;
      width: 100%;
      height: ${PANEL_HEIGHT}px;
      opacity: .9;
      pointer-events: none;
    }
 
  </style>`;const pickerTemplate=document.createElement("template");pickerTemplate.innerHTML=`
  <div class="scroll-picker-container">
    <div class="scroll-picker-panel">
        <div class="scroll-picker-panel-header">
            <button class="scroll-picker-btn scroll-picker-cancel-btn">Cancel</button>
            <div class="scroll-picker-title"></div>
            <button class="scroll-picker-btn scroll-picker-confirm-btn">Confirm</button>
        </div>
        <div class="scroll-picker-panel-content">

        </div>
        <div class="scroll-picker-center">
        </div>
        <div class="scroll-picker-mask"></div>
    </div>
  </div>
`;class ScrollPicker extends HTMLElement{constructor(){super(),this.onSelected=this.onSelected.bind(this),this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this),this.touchEnd=this.touchEnd.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this._stopPropagation=this._stopPropagation.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this._onOverlayClick=this._onOverlayClick.bind(this),this.isOverlayStopCancel=!1,this.startY=0,this.originalY=0,this.isMoving=!1,this.curDistance=[],this.offsetStep=40,this.value=[],this.columData=[],this._options={},this._cancelText="Cancel",this._confirmText="Confirm",this._shadowRoot=this.attachShadow({mode:"open"}),this._shadowRoot.appendChild(containerTemplate.content.cloneNode(!0)),this.picker=this.generatePicker()}connectedCallback(){this.bindEvents(),this.attachStyle()}generatePicker(){return this._pickerRoot=document.createElement("div"),this._pickerRoot.appendChild(pickerTemplate.content.cloneNode(!0)),document.querySelector("body").appendChild(this._pickerRoot),this._pickerRoot.querySelector(".scroll-picker-container")}show(){this.picker.classList.add("scroll-picker-show")}hide(){this.picker.classList.remove("scroll-picker-show")}static get observedAttributes(){return["title","colums","options","stopoverlaycancel","cancelText","confirmText"]}set title(e){this.setTitle(e)}set stopoverlaycancel(e){this.isOverlayStopCancel=Boolean(e)}set options(e){e.title&&this.setTitle(e.title),e.colum&&this.render(e.colum),e.cancelText&&this.updateCancelText(e.cancelText),e.confirmText&&this.updateConfirmText(e.confirmText),this._options=e,this.applyTheme(e)}get colums(){return this.columData}set colums(e){this.columData=e,this.render(e)}get confirmText(){return this._confirmText}set confirmText(e){this._confirmText=e,this.updateConfirmText(e)}get cancelText(){return this._cancelText}set cancelText(e){this._cancelText=e,this.updateCancelText(e)}attributeChangedCallback(e,t,o){switch(e){case"title":this.setTitle(o);break;case"colums":this.columData=JSON.parse(o),this.render(this.columData);break;case"options":var i=JSON.parse(o);this.setTitle(i.title),i.colum&&this.render(i.colum),i.cancelText&&this.updateCancelText(i.cancelText),i.confirmText&&this.updateConfirmText(i.confirmText),this._options=i;break;case"stopoverlaycancel":this.isOverlayStopCancel=Boolean(JSON.parse(o))}}setTitle(e){this._pickerRoot.querySelector(".scroll-picker-title").innerHTML=e}updateCancelText(e){this._pickerRoot.querySelector(".scroll-picker-cancel-btn").innerHTML=e}updateConfirmText(e){this._pickerRoot.querySelector(".scroll-picker-confirm-btn").innerHTML=e}render(e){this.columData=e;const o=this._pickerRoot.querySelector(".scroll-picker-panel-content");e.forEach((e,i)=>{const r=document.createElement("div");r.className="scroll-picker-colum";var t=e.length;r.minOffset=90-(t-1)*this.offsetStep,r.maxOffset=90,r.offset=90,r.items=t,e.forEach((e,t)=>{const o=document.createElement("div");o.className="scroll-picker-row",o.targetOffset=90-t*this.offsetStep,o.columIndex=i,o.index=t,o.innerHTML=e.value,r.appendChild(o)}),this.value[i]={index:0,value:e[0].value||null},this.attachEvents2Colum(r,i),o.appendChild(r),this.movePosition(r,90)})}attachEvents2Colum(t,o){t.addEventListener("touchstart",this.touchStart,!1),t.addEventListener("touchend",e=>{this.touchEnd(e,o,t)},!1),t.addEventListener("touchmove",e=>{this.touchMove(e,o,t)},!1),t.addEventListener("mousedown",this.touchStart,!1),t.addEventListener("mouseup",e=>{this.touchEnd(e,o,t)},!1),t.addEventListener("mousemove",e=>{this.touchMove(e,o,t)},!1),document.addEventListener("mouseup",this.onMouseUp,!1)}onMouseUp(){this.isMoving=!1}touchStart(e){this.isMoving=!0,this.startY=parseInt((e.touches&&e.touches[0]?e.touches[0]:e).clientY),this.originalY=this.startY}touchMove(e,t,o){this.isMoving&&(e.preventDefault(),this.moveY=parseInt((e.touches&&e.touches[0]?e.touches[0]:e).clientY),this.offset=this.moveY-this.originalY,this.curDistance[t]=this.getCurrentDistance(o)+this.offset,this.movePosition(o,this.curDistance[t]),this.originalY=this.moveY)}touchEnd(e,t,o){this.isMoving=!1,this.moveEndY=parseInt(e.touches&&e.touches[0]?e.touches[0].clientY:e.clientY||this.startY),this.offsetSum=this.moveEndY-this.startY,this.calculateMoveDistance(e,t,o)}calculateMoveDistance(e,t,o){if(Math.abs(this.offsetSum)<=10){var i=e.target.targetOffset,r=e.target.index,s=e.target.columIndex;return Boolean(i)&&Boolean(-1<r)&&Boolean(-1<s)?(this.movePosition(o,i),void(this.value[s]={index:r,value:this.columData[s][r].value})):void 0}var e=this.curDistance[t],{maxOffset:i,minOffset:s,items:r}=o;if(i<e)return this.movePosition(o,90),void(this.value[t]={index:0,value:this.columData[t][0].value});if(e<s)return this.movePosition(o,s),void(this.value[t]={index:r-1,value:this.columData[t][r-1].value});e=Math.round((90-e)/40);this.movePosition(o,90-40*e),this.value[t]={index:e,value:this.columData[t][e].value}}movePosition(e,t){var o=`translateY(${t}px)`;e.style.webkitTransform=o,e.style.transform=o,e.offset=t}getCurrentDistance(e){return Number(e.offset||90)}bindEvents(){this._pickerRoot.querySelector(".scroll-picker-panel").addEventListener("click",this._stopPropagation),this._pickerRoot.querySelector(".scroll-picker-cancel-btn").addEventListener("click",this.hide),this._pickerRoot.querySelector(".scroll-picker-confirm-btn").addEventListener("click",this.onSelected),this._shadowRoot.querySelector(".scroll-picker-trigger").addEventListener("click",this.show),this.picker.addEventListener("click",this._onOverlayClick)}unbindEvents(){this._pickerRoot.querySelector(".scroll-picker-panel").removeEventListener("click",this._stopPropagation),this._pickerRoot.querySelector(".scroll-picker-cancel-btn").removeEventListener("click",this.hide),this._pickerRoot.querySelector(".scroll-picker-confirm-btn").removeEventListener("click",this.onSelected),this._shadowRoot.querySelector(".scroll-picker-trigger").removeEventListener("click",this.show),this.picker.removeEventListener("click",this._onOverlayClick)}_onOverlayClick(){this.isOverlayStopCancel||this.hide()}_stopPropagation(e){e.stopPropagation()}onSelected(){this.dispatchEvent(new CustomEvent("change",{detail:this.value})),this.hide()}attachStyle(){var e=document.querySelector("#scroll-picker-style-container");if(!Boolean(e)){const t=document.createElement("div");t.id="scroll-picker-style-container",t.appendChild(styleTemplate.content.cloneNode(!0)),document.querySelector("body").appendChild(t)}this.applyTheme(this._options)}applyTheme(e){const t=document.querySelector("#scroll-picker-theme-container");Boolean(t)&&t.remove();var o="dark"===e.theme?DEFAULT_DARK_COLOR:DEFAULT_LIGHT_COLOR;const i=document.createElement("div");i.id="scroll-picker-theme-container",i.innerHTML=`
    <style>
    .scroll-picker-container {
      background-color: ${e.containerBackgroundColor||o.containerBackgroundColor}
    }


    .scroll-picker-panel {
      background-color: ${e.panelBackground||o.panelBackground}
    }

    .scroll-picker-panel-header {
      border-bottom: 1px solid ${e.panelHeaderBorderColor||o.panelHeaderBorderColor};
    }

    .scroll-picker-title {
      color: ${e.titleColor||o.titleColor}
    }

    .scroll-picker-cancel-btn {
      color: ${e.cancelButtonColor||o.cancelButtonColor};
    }

    .scroll-picker-confirm-btn {
      color: ${e.confirmButtonColor||o.confirmButtonColor};
    }

    .scroll-picker-panel-content {
        color: ${e.textColor||o.textColor};
    }

    .scroll-picker-center {
      border: 1px solid ${e.focusBorderColor||o.focusBorderColor};
    }

    .scroll-picker-mask {
      background: linear-gradient(${e.maskBackgroundColor||o.maskBackgroundColor}, rgba(45, 52, 61, 0), ${e.maskBackgroundColor||o.maskBackgroundColor});
    }
 
  </style>`,document.querySelector("body").appendChild(i)}destory(){this.unbindEvents(),this._pickerRoot.remove()}}window.customElements.define("scroll-picker",ScrollPicker);